function _array_like_to_array(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function asyncGeneratorStep(e,n,t,o,r,i,s){try{var a=e[i](s),l=a.value}catch(e){return void t(e)}a.done?n(l):Promise.resolve(l).then(o,r)}function _async_to_generator(e){return function(){var n=this,t=arguments;return new Promise((function(o,r){var i=e.apply(n,t);function s(e){asyncGeneratorStep(i,o,r,s,a,"next",e)}function a(e){asyncGeneratorStep(i,o,r,s,a,"throw",e)}s(void 0)}))}}function _class_call_check(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _create_class(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}function _define_property(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,r,i=[],s=!0,a=!1;try{for(t=t.call(e);!(s=(o=t.next()).done)&&(i.push(o.value),!n||i.length!==n);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==t.return||t.return()}finally{if(a)throw r}}return i}}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),o.forEach((function(n){_define_property(e,n,t[n])}))}return e}function ownKeys(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function _object_spread_props(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function _sliced_to_array(e,n){return _array_with_holes(e)||_iterable_to_array_limit(e,n)||_unsupported_iterable_to_array(e,n)||_non_iterable_rest()}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _unsupported_iterable_to_array(e,n){if(e){if("string"==typeof e)return _array_like_to_array(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_array_like_to_array(e,n):void 0}}function _ts_generator(e,n){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4296],{89965:function(e,n,t){"use strict";t.d(n,{lO:function(){return i},sc:function(){return r},wR:function(){return s}});var o=t(79614);function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.jA.get("/v2/user/response_data/".concat(e),n)}function i(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.jA.post("/v2/chat",e,n)}function s(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.jA.post("/v2/message",e,n)}},65514:function(e,n,t){"use strict";t.d(n,{$:function(){return i},V:function(){return s}});var o=t(17902),r=t(89965),i=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.Db)((function(n){return(0,r.wR)(n,e)}),n)},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,o.Db)(r.lO,e)}},41809:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var o=t(32930),r=t(67540),i=t.n(r),s=t(76303),a=t.n(s),l=t(88107),u=function(e){e.stopPropagation()};function c(e){var n,t,r,s=e.hashtag,c=e.onHashtagClick,d=e.isReelInstance,_=void 0!==d&&d,f=(0,l.Z)(),p=(null!==(r=null==s||null===(n=s.hashtag)||void 0===n?void 0:n.lastIndexOf("#"))&&void 0!==r?r:-1)+1,v=null==s||null===(t=s.hashtag)||void 0===t?void 0:t.slice(p);return(0,o.jsxs)("div",{onMouseUp:u,onClick:function(e){e.stopPropagation(),null==c||c(),setTimeout((function(){f.push(_?"/reel/hashtag/".concat(v):"/story/hashtag/".concat(v))}),1e3)},className:i()["new-hashtag-entity"],children:[(0,o.jsx)(a(),{size:"16",name:"bi-hashtag"}),(0,o.jsx)("div",{className:i()["new-hashtag-entity__detail"],children:v})]})}},44578:function(e,n,t){"use strict";var o=t(32930),r=t(74463),i=t.n(r),s=t(76303),a=t.n(s),l=t(88107),u=function(e){e.stopPropagation()};n.Z=function(e){var n=e.link,t=e.onLinkClick,r=(0,l.Z)();return(0,o.jsxs)("div",{onMouseUp:u,onClick:function(){null==t||t(),setTimeout((function(){r.push(null==n?void 0:n.link)}),500)},className:i()["new-link-entity"],children:[(0,o.jsx)("div",{className:i()["new-link-entity-icon"],children:(0,o.jsx)(a(),{size:"32",name:"bi-link"})}),(0,o.jsxs)("div",{className:i()["new-link-entity__detail"],children:[(0,o.jsx)("div",{className:i()["new-link-entity__detail-title"],children:null==n?void 0:n.title}),(0,o.jsx)("div",{className:i()["new-link-entity__detail-path"],children:null==n?void 0:n.link})]})]})}},39027:function(e,n,t){"use strict";var o=t(32930),r=t(89208),i=t.n(r),s=t(88107),a=t(5164),l=function(e){e.stopPropagation()};n.Z=function(e){var n=e.product,t=e.vendorId,r=e.onProductClick,u=(0,s.Z)();return(0,o.jsxs)("div",{onMouseUp:l,onClick:function(){null==r||r(),setTimeout((function(){u.push("/".concat(t,"/product/").concat(n.id))}),200)},className:i()["new-product-entity"],children:[(0,o.jsx)("div",{className:i()["new-product-entity-img"],children:(0,o.jsx)("img",{src:n.photo.medium,alt:n.title})}),(0,o.jsxs)("div",{className:i()["new-product-entity__detail"],children:[(0,o.jsx)("div",{className:i()["new-product-entity__detail-title"],children:n.title}),(0,o.jsxs)("div",{className:i()["new-product-entity__detail-price"],children:[(0,a.numberSeparator)((0,a.rialToToman)(n.price)),(0,o.jsx)("span",{className:"bi-toman"})]})]})]})}},18622:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var o=t(32930),r=t(40877),i=t(39701),s=t.n(i),a=t(27434);function l(e){var n=e.photo,t=e.onImageLoad,i=e.className,l=(0,a.useRef)(new Image);return(0,a.useEffect)((function(){l.current.crossorigin=!0,l.current.src=n.url}),[n.url]),(0,a.useEffect)((function(){if(t){var e=l.current;return e.addEventListener("load",t),function(){e.removeEventListener("load",t)}}}),[t]),(0,o.jsx)("div",{className:(0,r.Z)(s()["base-image-content"],i),style:{backgroundImage:"url(".concat(n.url,")")}})}},34296:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Oe}});var o=t(32930),r=t(40877),i=t(33842),s=t.n(i),a=t(65074),l=t.n(a),u=t(88107),c=function(e){e.stopPropagation()};function d(e){var n=e.link,t=e.onClick,r=e.top,i=e.left,a=e.width,d=(0,u.Z)();return(0,o.jsx)("div",{className:s()["link-entity"],style:{top:r,left:i,width:a},onMouseUp:c,children:(0,o.jsx)(l(),{icon:"bi-link",label:null==n?void 0:n.title,onClick:function(){null==t||t(),setTimeout((function(){d.push(null==n?void 0:n.link)}),500)},variant:"outline",color:"secondary",size:"xs",iconPosition:"center-start",className:s()["link-entity__button"]})})}var _=t(46236),f=t.n(_),p=t(2389),v=t.n(p),h=t(89184),y=t.n(h),m=t(27434),b=t(92034),g=t.n(b),j=t(33918),x=t(41545),w=t.n(x),k=t(36350),S=t(87694),C=t(45835),N=function(e){var n=e.storyId,t=e.onClose,r=e.onDelete,i=e.show,s=(0,S.lj)(),a=s.mutate,u=s.isLoading,c=(0,k.useSnackbar)().showSuccessSnackbar,d=(0,C.b)().ua;return(0,o.jsx)(g(),{show:i,onClose:t,title:d.isMobile?"":"حذف استوری",showClose:!d.isMobile,size:"sm",headerClass:w().ds__header,bodyClass:w().ds__body,footerClass:w().ds__footer,footerComponent:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l(),{fullWidth:d.isMobile,size:"sm",loading:u,disabled:u,label:"آره، حذف بشه",variant:"fill",color:"primary",onClick:function(){a(n,{onSuccess:function(){c("استوری شما با موفقیت حذف شد"),t(),null==r||r()}})}}),(0,o.jsx)(l(),{fullWidth:d.isMobile,size:"sm",label:"نه، باشه هنوز",variant:"outline",color:"secondary",onClick:t})]}),children:(0,o.jsx)("span",{children:"این استوری رو حذف کنیم؟ بعدا قابل برگشت نیست."})})},I=v()((function(){return t.e(4306).then(t.bind(t,4306))}),{loadableGenerated:{webpack:function(){return[4306]}},ssr:!1}),E=function(e){var n=e.user,t=e.story,r=e.onClose,i=e.onDelete,s=e.closeModal,a=e.suggestLabel,l=e.isMyStory,u=void 0!==l&&l,c=e.isShowModal,d=void 0!==c&&c,_=(0,k.useEmitter)().emitEvent,f=(0,S.xT)(),p=(0,S.TA)(),v=(0,k.useSnackbar)(),h=v.showSuccessSnackbar,b=v.hideSnackbar,x=_sliced_to_array((0,m.useState)(!1),2),w=x[0],C=x[1],E=_sliced_to_array((0,m.useState)(!1),2),P=E[0],O=E[1],T=(0,m.useRef)(!1),M=(0,S.kZ)(),L=_to_consumable_array("suggested"===a?[{id:1,more:!1,icon:"bi-eye-off",onClick:function(){T.current=!1,f.mutate(n.user.id,{onSuccess:function(){h("دیگه محتوایی از این غرفه بهت نمایش نمی‌دیم",{showProgressBar:!0,action:{type:"text",label:"لغو",onClick:function(e){return function(e){T.current=!0,b(e),p.mutate(n.user.id)}(e)}}}),r(),setTimeout((function(){T.current||M(n.user.id)}),4e3)}})},title:"دیگه این غرفه رو نشونم نده"}]:[]).concat([{id:2,more:!0,icon:"bi-share",title:"اشتراک‌گذاری",onClick:function(){C(!0)}}],_to_consumable_array(!1===u?[{id:3,more:!0,icon:"bi-report",title:"گزارش تخلف",onClick:function(){_("show-report-content-modal",{entityId:t.id,entityType:"STORY",source:"STORY_SINGLE",reportType:j.Rc.STORY})}}]:[{id:3,more:!1,icon:"bi-trash",title:"حذف استوری",onClick:function(){O(!0)}}]));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g(),{size:"sm",show:d,onClose:s,showHeader:!0,children:L.map((function(e){return(0,o.jsxs)("div",{className:y().action,onClick:e.onClick,children:[(0,o.jsxs)("div",{className:y().action__head,children:[(0,o.jsx)("i",{className:e.icon}),(0,o.jsx)("div",{className:y().action__title,children:e.title})]}),e.more&&(0,o.jsx)("i",{className:"bi-angle-left"})]},e.id)}))}),w&&(0,o.jsx)(I,{show:!0,type:"STORY",entity:_object_spread_props(_object_spread({},t),{vendor:_object_spread({},n.user.vendor)}),onClose:function(){C(!1)}}),P&&(0,o.jsx)(N,{show:P,onDelete:function(){i(),s()},onClose:function(){O(!1)},storyId:null==t?void 0:t.id})]})},P=t(5164),O=t(46841),T=t.n(O),M=t(76303),L=t.n(M),D=function(e){e.stopPropagation()};function A(e){var n,t,i,s=e.hashtag,a=e.onHashtagClick,l=e.variant,c=void 0===l?"fill":l,d=(0,u.Z)(),_=(null!==(i=null==s||null===(n=s.hashtag)||void 0===n?void 0:n.lastIndexOf("#"))&&void 0!==i?i:-1)+1,f=null==s||null===(t=s.hashtag)||void 0===t?void 0:t.slice(_);return(0,o.jsxs)("div",{onMouseUp:D,onClick:function(e){e.stopPropagation(),null==a||a(),setTimeout((function(){d.push("/story/hashtag/".concat(f))}),1e3)},className:(0,r.Z)(T()["hashtag-entity--".concat(c)],T()["hashtag-entity"]),children:[(0,o.jsx)(L(),{size:"16",name:"bi-hashtag",color:"transparent"===c&&"var(--white)"}),(0,o.jsx)("div",{className:T()["hashtag-entity__detail"],children:f})]})}var Z=t(74511),R=t.n(Z),U=function(e){e.stopPropagation()},z=function(e){var n=e.product,t=e.onProductClick,i=e.vendorId,s=e.variant,a=void 0===s?"fill":s,l=(0,u.Z)();return(0,o.jsxs)("div",{onMouseUp:U,onClick:function(){null==t||t(),setTimeout((function(){l.push("/".concat(i,"/product/").concat(n.id))}),200)},className:(0,r.Z)(R()["product-entity--".concat(a)],R()["product-entity"]),children:[(0,o.jsx)("img",{className:R()["product-entity--".concat(a,"-img")],src:n.photo.medium,alt:n.title}),(0,o.jsxs)("div",{className:R()["product-entity__detail"],children:[(0,o.jsx)("div",{className:R()["product-entity__detail-title"],children:n.title}),(0,o.jsxs)("div",{className:R()["product-entity__detail-price"],children:[(0,P.numberSeparator)((0,P.rialToToman)(n.price)),(0,o.jsx)("span",{className:"bi-toman"})]})]})]})},H=t(26145),F=t.n(H);function V(e){var n=e.story;return(0,o.jsxs)("div",{className:F()["story-status-bar"],children:[(0,o.jsxs)("div",{className:F()["story-status-bar__wrapper"],children:[(0,o.jsx)(L(),{size:"20",color:"var(--gray-100)",name:"bi-liked"}),(0,o.jsx)("span",{className:F()["story-status-bar__span"],children:null==n?void 0:n.likeCount})]}),(0,o.jsxs)("div",{className:F()["story-status-bar__wrapper"],children:[(0,o.jsx)(L(),{size:"20",color:"var(--gray-100)",name:"bi-eye-fill"}),(0,o.jsx)("span",{className:F()["story-status-bar__span"],children:null==n?void 0:n.viewCount})]})]})}var G=t(76088),Y=t(84581),B=t(88592),W=t(54139),J=t.n(W),X=function(e){var n=e.top,t=e.left,r=e.width,i=e.children;return(0,o.jsx)("div",{style:{top:n,left:t,width:r},className:J().position,children:i})},K=t(50874),q=t.n(K),Q=t(5044),$=t.n(Q),ee=t(73620),ne=t.n(ee),te=t(41809),oe=t(44578),re=t(39027),ie=function(e){e.stopPropagation()};function se(e){var n=e.link,t=e.products,r=e.hashtags,i=e.user,s=e.onClose,a=(0,C.b)().ua,l=!!t&&t.length>0,u=!!r&&r.length>0,c=!!n;return l||c||u?(0,o.jsxs)("div",{className:$().wrapper,onClick:ie,onMouseDown:ie,onMouseUp:ie,onTouchEnd:ie,onTouchStart:ie,onTouchMove:ie,children:[(l||c)&&(0,o.jsxs)(ne(),{slidesPerView:a.isPc?1.3:1.1,spaceBetween:12,children:[l&&t.map((function(e){return(0,o.jsx)(ne().Item,{children:(0,o.jsx)(re.Z,{product:e,vendorId:null==i?void 0:i.vendor.identifier,onProductClick:s})},null==e?void 0:e.id)})),c&&(0,o.jsx)(ne().Item,{children:(0,o.jsx)(oe.Z,{link:n,onLinkClick:s})})]}),u&&(0,o.jsx)(ne(),{spaceBetween:12,children:r.map((function(e){return(0,o.jsx)(ne().Item,{className:$()["wrapper__hashtags-item"],children:(0,o.jsx)(te.Z,{hashtag:e,onHashtagClick:s})},null==e?void 0:e.id)}))})]}):null}se.propTypes={link:q().object,hashtags:q().array,products:q().array};var ae=function(){function e(n){_class_call_check(this,e),this._duration=n,this._onEnd=null,this._elapsedDuration=0,this._startTime=null,this._timeoutId=null}return _create_class(e,[{key:"start",value:function(){var e=this;if(null===this._startTime){this._startTime=Date.now();var n=this._duration-this._elapsedDuration;this._timeoutId=setTimeout((function(){e._end()}),n)}}},{key:"setOnEnd",value:function(e){this._onEnd=e}},{key:"pause",value:function(){if(null!==this._startTime){var e=Date.now()-this._startTime;this._elapsedDuration+=e,this._startTime=null,this.clear()}}},{key:"clear",value:function(){null!==this._timeoutId&&clearTimeout(this._timeoutId)}},{key:"_end",value:function(){this.clear(),"function"==typeof this._onEnd&&this._onEnd()}}]),e}(),le=t(18622);function ue(e){var n=e.photo,t=e.shouldPlay,r=e.onLoad,i=e.onEnd,s=(0,m.useRef)(null);(0,m.useEffect)((function(){var e;return s.current=new ae(6e3),null===(e=s.current)||void 0===e||e.setOnEnd((function(){null==i||i()})),function(){s.current.clear(),s.current=null}}),[n]),(0,m.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.setOnEnd((function(){null==i||i()}))}),[i]),(0,m.useEffect)((function(){t?s.current.start():s.current.pause()}),[t,n]);var a=(0,m.useCallback)((function(){var e;t&&(null===(e=s.current)||void 0===e||e.start());"function"==typeof r&&r(6)}),[r,t]);return(0,o.jsx)(le.Z,{photo:n,onImageLoad:a})}var ce=t(33070),de=t(29723),_e=t(61262),fe=t(60802),pe=t(65514),ve=t(55253),he=t.n(ve),ye=t(81174),me=t.n(ye),be={xpos:200,ypos:1800,width:360,height:30},ge={xpos:108,ypos:1686,width:864,height:192};function je(e,n){return{width:"".concat(e.width*n.scale,"px"),left:e.positionX?"".concat(e.positionX*n.scale+n.leftOffset,"px"):"".concat(e.xpos*n.scale+n.leftOffset,"px"),top:e.positionY?"".concat(e.positionY*n.scale+n.topOffset,"px"):"".concat(e.ypos*n.scale+170*n.scale+n.topOffset,"px")}}var xe=function(e){var n,t,i,s,a,c,_,p,v=e.user,h=e.story,y=e.onEnd,b=e.onLoad,g=e.onStart,j=e.onPause,x=e.onClose,w=e.onResume,C=e.onDelete,N=e.isMyStory,I=e.suggestLabel,O=e.muted,T=void 0!==O&&O,M=e.onStoryMutation,D=e.showVendor,Z=void 0===D||D,R=(0,fe.l)().getFeatureValue,U=(0,m.useMemo)((function(){return R("story_fixed_widget")}),[R]),H=(0,u.Z)(),F=(0,k.useEmitter)().emitEvent,W=(0,k.useSnackbar)().showErrorSnackbar,J=(0,S.oE)(),K=(0,k.useSnackbar)().showSuccessSnackbar,q=(0,S.I1)(),Q=(0,pe.V)(),$=Q.mutateAsync,ee=Q.isLoading,ne=(0,pe.$)(),te=ne.mutateAsync,oe=ne.isLoading,re=null!==h.video,ie=(0,de.Kp)(["isIosApp"]).isIosApp,ae=!(re&&ie),le=_sliced_to_array((0,m.useState)(!1),2),ve=le[0],ye=le[1],xe=_sliced_to_array((0,m.useState)(!1),2),we=xe[0],ke=xe[1],Se=_sliced_to_array((0,m.useState)(T),2),Ce=Se[0],Ne=Se[1],Ie=_sliced_to_array((0,m.useState)(""),2),Ee=Ie[0],Pe=Ie[1],Oe=(0,B.M_)(["banStatus","currentUser"]),Te=Oe.banStatus,Me=Oe.currentUser,Le=(0,_e.B)().authForm.toggleModal,De=_sliced_to_array((0,m.useState)(!1),2),Ae=De[0],Ze=De[1],Re=_sliced_to_array((0,m.useState)(!1),2),Ue=Re[0],ze=Re[1],He=(0,m.useRef)(null),Fe=(0,m.useRef)(null),Ve=(0,m.useRef)(null),Ge=(0,m.useRef)(null),Ye=(0,S.$B)().mutate,Be=h.products.length>0,We=null!==h.link,Je=h.hashtags.length>0,Xe=(0,m.useMemo)((function(){return(0,P.jalaliDate)(h.createdAt).fromNow()}),[h]),Ke=Ge.current,qe=(0,m.useMemo)((function(){var e,n,t,o,r,i,s,a,l=null==h?void 0:h.metadata;if(null===Ke)return{scale:0,topOffset:0,leftOffset:0};var u=Ke.clientWidth,c=Ke.clientHeight,d=null!==(i=null!==(r=null==l||null===(e=l.story)||void 0===e?void 0:e.containerWidth)&&void 0!==r?r:null==l||null===(n=l.story)||void 0===n?void 0:n.width)&&void 0!==i?i:1080,_=null!==(a=null!==(s=null==l||null===(t=l.story)||void 0===t?void 0:t.containerHeight)&&void 0!==s?s:null==l||null===(o=l.story)||void 0===o?void 0:o.height)&&void 0!==a?a:2186,f=u/d,p=c/_,v=Math.min(f,p);return{topOffset:(p-v)*_/2,leftOffset:(f-v)*d/2,scale:v}}),[h,Ke]),Qe=function(){ye(!1),j()},$e=function(){ye(!0),w()},en=(0,m.useCallback)((function(e){null==b||b(e),ae&&(ye(!0),null==g||g())}),[b,g,ae]),nn=function(){var e=_async_to_generator((function(){return _ts_generator(this,(function(e){switch(e.label){case 0:return void 0===Me?(Le(),[2]):Te.social?(F("open-ban-modal"),[2]):we?[4,q.mutateAsync(h.id)]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,J.mutateAsync(h.id)];case 3:e.sent(),e.label=4;case 4:return ke(!we),null==M||M(h.id,{isLiked:!we}),[2]}}))}));return function(){return e.apply(this,arguments)}}(),tn=function(){var e=_async_to_generator((function(e){var n,t,o,r;return _ts_generator(this,(function(i){switch(i.label){case 0:if(e.preventDefault(),0===Ee.length)return[3,6];i.label=1;case 1:return i.trys.push([1,4,5,6]),[4,$({hashId:v.user.hashId,chatType:"PRIVATE"})];case 2:return n=i.sent(),t=n.data,o={chatId:t.id,messageType:"STORY",message:{text:Ee,entityId:h.id}},[4,te(o)];case 3:return i.sent(),Pe(""),K("پیام با موفقیت ارسال شد"),[3,6];case 4:return i.sent(),W("پیام ارسال نشد مجددا تلاش کنید"),[3,6];case 5:return null===(r=Ve.current)||void 0===r||r.focusout(),[7];case 6:return[2]}}))}));return function(n){return e.apply(this,arguments)}}(),on=function(){x(),setTimeout((function(){H.push("/".concat(v.user.vendor.identifier))}),200)},rn=(0,m.useCallback)((function(e){e.stopPropagation()}),[]);(0,m.useEffect)((function(){(function(){var e,n,t;(0,Y.s)("newStoryViewed",{storyId:h.id,isLike:h.isLiked,hasVideo:!!h.video,isFollow:h.isFollowed,createdAt:h.createdAt,userIdCreated:v.user.id,vendorId:v.user.vendor.id,userIdViewed:null==Me?void 0:Me.id,entityId:(null==h||null===(e=h.entity)||void 0===e?void 0:e.id)||0,isSeen:null!==(t=h.isSeen)&&void 0!==t?t:void 0,vendorName:null===(n=v.user.vendor)||void 0===n?void 0:n.title,hasPhoto:h.photo?"true":"false",vendorIdentifier:v.user.vendor.identifier,entityTypeId:(null==h?void 0:h.entityTypeId)?String(h.entityTypeId):""})})(),ke(h.isLiked),void 0!==Me&&Ye(h.id),ye(!1),null==M||M(h.id,{isSeen:!0})}),[h.id]);var sn=(0,m.useMemo)((function(){var e,n,t;return v?{name:v.user.name,followSource:"story",targetUserId:v.user.id,vendorId:null===(e=v.user.vendor)||void 0===e?void 0:e.id,vendorName:null===(n=v.user.vendor)||void 0===n?void 0:n.title,vendorIdentifier:null===(t=v.user.vendor)||void 0===t?void 0:t.identifier}:null}),[v]);return(0,o.jsxs)("div",{className:f().ss,children:[(0,o.jsx)("header",{className:f().ss__header,onMouseUp:rn,children:(0,o.jsxs)("div",{className:f().ss__vendor,children:[(0,o.jsxs)("div",{className:f()["ss__vendor-info"],children:[(0,o.jsx)("div",{onClick:Z?on:void 0,children:(0,o.jsx)(he(),{size:40,src:null===(n=v.user.avatar)||void 0===n?void 0:n.small})}),(0,o.jsxs)("div",{className:f()["ss__vendor-introduction"],children:[Z&&(0,o.jsxs)("div",{className:f()["ss__vendor-identifier"],children:[(0,o.jsx)("div",{className:f()["ss__vendor-identifier-title"],onClick:on,children:v.user.vendor.title}),!h.isFollowed&&!N&&(0,o.jsx)(G.Z,{eventData:sn,targetUserId:v.user.id,targetUserHashId:v.user.hashId,buttonProps:{size:"xxs",variant:"fill"}})]}),(0,o.jsxs)("div",{className:f()["ss__vendor-detail"],onClick:Z?on:void 0,children:[(0,o.jsx)("div",{className:f()["ss__vendor-detail-name"],children:v.user.name}),(0,o.jsx)("div",{className:f()["ss__vendor-detail-separator"],children:"|"}),(0,o.jsx)("div",{className:f()["ss__vendor-detail-created-time"],children:Xe})]})]})]}),(0,o.jsxs)("div",{className:f()["ss__vendor-icons"],onClick:rn,children:[(0,o.jsx)("div",{className:(0,r.Z)(["bi-close",f()["ss__vendor-icon"]]),onClick:x}),h.video&&(0,o.jsx)("div",{className:(0,r.Z)([f()["ss__vendor-icon"],Ce?"bi-sound-mute":"bi-sound-open"]),onClick:function(){Ne(!Ce)}}),(0,o.jsx)("div",{className:(0,r.Z)(["bi-more-v",f()["ss__vendor-icon"]]),onClick:function(){Qe(),ze(!0)}})]})]})}),(0,o.jsxs)("div",{className:f().ss__content,onMouseDown:Qe,onMouseUp:$e,onTouchStart:function(e){Qe(),He.current=e.touches[0].clientY},onTouchMove:function(e){Fe.current=e.touches[0].clientY},onTouchEnd:function(){($e(),He.current&&Fe.current)&&(He.current-Fe.current<-100&&x());He.current=null,Fe.current=null},ref:Ge,children:[h.photo&&(0,o.jsx)(ue,{shouldPlay:ve,photo:h.photo,onLoad:en,onEnd:y}),h.video&&(0,o.jsx)(ce.Z,{poster:ie?null===(t=h.video)||void 0===t?void 0:t.thumbnail:void 0,muted:Ce,video:h.video,onLoad:en,shouldPlay:ve,onEnd:y,onPlay:function(){ae||(ye(!0),g())}}),U?(0,o.jsx)(se,{onClose:x,link:h.link,products:h.products,hashtags:h.hashtags,user:null==v?void 0:v.user},h.id):(0,o.jsxs)(o.Fragment,{children:[Be&&(0,o.jsx)(X,_object_spread_props(_object_spread({},je(null!==(_=null===(i=h.metadata)||void 0===i?void 0:i.product)&&void 0!==_?_:ge,qe)),{children:(0,o.jsx)(z,{product:h.products[0],vendorId:null===(s=v.user)||void 0===s?void 0:s.vendor.identifier,onProductClick:x})})),Je&&(0,o.jsx)(X,_object_spread_props(_object_spread({},je(null!==(p=null===(a=h.metadata)||void 0===a?void 0:a.hashtag)&&void 0!==p?p:be,qe)),{children:(0,o.jsx)(A,{hashtag:h.hashtags[0],onHashtagClick:x})})),We&&(0,o.jsx)(X,_object_spread_props(_object_spread({},je(null===(c=h.metadata)||void 0===c?void 0:c.link,qe)),{children:(0,o.jsx)(d,{link:h.link,onClick:x})}))]})]}),(0,o.jsxs)("div",{className:f().ss__footer,onMouseUp:rn,children:[!N&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("form",{onSubmit:tn,children:[(Ee.length>0||Ae)&&(0,o.jsx)(l(),{type:"submit",loading:ee||oe,variant:Ee.length>0?"fill":"outline",color:Ee.length>0?"primary":"secondary",icon:"bi-send-right",className:(0,r.Z)([f()["ss__footer-send"],_define_property({},f()["ss__footer-send--fill"],Ee.length)])}),(0,o.jsx)(me(),{ref:Ve.current,onChange:function(e){return Pe(e.target.value)},value:Ee,placeholder:"سوالت رو ازش بپرس",wrapperClassName:f()["ss__footer-input"],onFocus:function(e){if(void 0===Me)return e.preventDefault(),void Le();Ze(!0),Qe()},onBlur:function(){Ze(!1),$e()},readonly:void 0===Me})]}),!(Ee.length>0||Ae)&&(0,o.jsx)("div",{onClick:nn,className:f()["ss__footer-icon"],children:(0,o.jsx)(L(),{name:we?"bi-liked":"bi-like",size:"32",color:we?"#ff5c39":"white"})})]}),N&&(0,o.jsx)(V,{story:h})]}),Ue&&(0,o.jsx)("div",{onMouseDown:rn,onMouseUp:rn,onTouchStart:rn,onTouchMove:rn,onTouchEnd:rn,onClick:rn,children:(0,o.jsx)(E,{isMyStory:N,story:h,user:v,isShowModal:!0,closeModal:function(){$e(),ze(!1)},onClose:x,onDelete:C,suggestLabel:I})})]})},we=t(27510),ke=t.n(we),Se=t(25320),Ce=t.n(Se);function Ne(e){var n=e.duration,t=e.storyCount,i=e.shouldPlay,s=e.currentStoryId,a=e.currentStoryIndex,l=(0,m.useRef)(null);return(0,m.useEffect)((function(){null!==l.current&&(l.current.style.animationPlayState=i?"running":"paused")}),[i,s]),(0,m.useEffect)((function(){null!==l.current&&(l.current.style.animationDuration="".concat(n,"s"))}),[n,a]),(0,o.jsx)("div",{className:Ce()["story-progress-bar"],children:void 0!==a&&t>0&&(0,P.range)(t).map((function(e,n){return(0,o.jsx)("span",{className:(0,r.Z)(Ce()["story-progress-bar__item"],n<a?Ce()["story-progress-bar__item--filled"]:""),children:n===a&&(0,o.jsx)("span",{ref:l,className:Ce()["story-progress-bar__item-progress"]},s)},n)}))})}var Ie=t(26050),Ee=t.n(Ie),Pe=t(25867);function Oe(e){var n=e.show,t=e.data,r=e.muted,i=e.onNext,s=e.onClose,a=e.onDelete,l=e.isLoading,u=e.showVendor,c=e.onPrevious,d=e.preferredIndex,_=e.onStoryMutation,f=e.isMyStory,p=void 0!==f&&f,v=(0,C.b)().ua,h=_sliced_to_array((0,m.useState)(6),2),y=h[0],b=h[1],j=_sliced_to_array((0,m.useState)(!1),2),x=j[0],w=j[1],k=_sliced_to_array((0,m.useState)(0),2),S=k[0],N=k[1],I=(0,m.useRef)(null),E=_sliced_to_array((0,m.useState)(null),2),P=E[0],O=E[1],T=(0,de.Kp)(["isIosApp"]).isIosApp,M=null==t?void 0:t.stories,L=null==M?void 0:M[S];(0,Pe.Nl)({page:P,component:"story",enable:n&&P,meta:"".concat(null==L?void 0:L.id)});var D=0===S,A=S+1===(null==M?void 0:M.length),Z=(0,m.useRef)(null),R=(0,m.useCallback)((function(){w(!0)}),[]),U=(0,m.useCallback)((function(){w(!1)}),[]),z=(0,m.useCallback)((function(e){b(e)}),[]),H=(0,m.useCallback)((function(){A?null==i||i():(N(S+1),w(!1))}),[S,A,i]),F=(0,m.useCallback)((function(){D?null==c||c():(N(S-1),w(!1))}),[S,D,c]),V=(0,m.useCallback)((function(){A?void 0===i?s():i():H()}),[A,s,H,i]);return(0,m.useEffect)((function(){n&&O((function(e){return(0,Pe.rj)().comes_from_page||e}))}),[n]),(0,m.useEffect)((function(){var e,t;if(n){var o=null==M||null===(e=M[0])||void 0===e?void 0:e.id;if(I.current!==o){if("first"===d)N(0);else if("last"===d)N(M.length-1);else{var r=null!==(t=null==M?void 0:M.findIndex((function(e){return!1===e.isSeen})))&&void 0!==t?t:-1;N(-1===r?0:r)}w(!1),I.current=o}}}),[n,M,d]),(0,o.jsx)(g(),{show:n,isPlain:!0,isFullScreen:!v.isDesktop,onClose:s,size:"lg",className:ke().story__modal,children:(0,o.jsxs)("div",{className:ke().story__container,onMouseDown:function(){Z.current=Date.now()},onMouseUp:function(e){var n=e.nativeEvent.offsetX/e.target.clientWidth;Date.now()-Z.current<500&&(T?n<.3?H():n>.7&&F():n<.66?H():F())},children:[(0,o.jsx)("div",{className:ke()["story__progress-bar-container"],children:(0,o.jsx)(Ne,{duration:y,currentStoryIndex:S,storyCount:null==M?void 0:M.length,shouldPlay:x,currentStoryId:null==L?void 0:L.id})}),l?(0,o.jsx)(Ee(),{}):l||void 0===L?(0,o.jsx)("div",{className:ke()["story__not-available"],children:(0,o.jsxs)("div",{children:[(0,o.jsx)("i",{className:"bi-info"})," متاسفانه این استوری در دسترس نیست"]})}):(0,o.jsx)(xe,{isMyStory:p,story:L,user:t,onLoad:z,onStart:R,onPause:U,onResume:R,onEnd:V,onClose:s,showVendor:u,onStoryMutation:_,onDelete:function(){D||N(S-1),a(!(!D||!A))},muted:r,suggestLabel:t.suggestLabel})]})})}},33070:function(e,n,t){"use strict";var o=t(32930),r=t(45843),i=t.n(r),s=t(4260),a=t.n(s),l=t(27434),u=(0,l.memo)(a());n.Z=(0,l.memo)((function(e){var n=e.muted,t=e.video,r=e.onEnd,s=e.onLoad,a=e.poster,c=e.onPlay,d=e.onLoading,_=e.shouldPlay,f=e.loop,p=void 0!==f&&f,v=e.playReel,h=void 0===v||v,y=(0,l.useRef)(null);return(0,l.useEffect)((function(){null!==y.current&&(y.current.mute=n)}),[n]),(0,l.useEffect)((function(){var e=function(){var e;s(null===(e=y.current)||void 0===e?void 0:e.duration)},n=function(){null==r||r()},t=function(){_||c()},o=function(){null==d||d()},i=function(){c()},a=y.current;return null==a||a.addEventListener("loadedmetadata",e),null==a||a.addEventListener("ended",n),null==a||a.addEventListener("play",t),null==a||a.addEventListener("waiting",o),null==a||a.addEventListener("canplay",i),function(){null==a||a.removeEventListener("loadedmetadata",e),null==a||a.removeEventListener("ended",n),null==a||a.removeEventListener("play",t),null==a||a.removeEventListener("waiting",o),null==a||a.removeEventListener("canplay",i)}}),[s,r,c,_,d]),(0,l.useEffect)((function(){var e=y.current;return _&&h?null==e||e.play():null==e||e.pause(),function(){e.pause(),e.mute=!0}}),[_,h]),(0,o.jsx)(u,{poster:a,playsInline:!0,ref:y,muted:n,controls:!1,className:i()["story-video-content"],src:t.url,loop:p,children:(0,o.jsx)("source",{src:t.url,type:"video/mp4"})})}))},67540:function(e){e.exports={"new-hashtag-entity":"sicIHP","new-hashtag-entity__detail":"_4x6DTo"}},74463:function(e){e.exports={"new-link-entity":"ohEzVu","new-link-entity-icon":"SCwXjE","new-link-entity__detail":"zOT2gp","new-link-entity__detail-title":"PGO9jU","new-link-entity__detail-path":"y_SJZ_"}},89208:function(e){e.exports={"new-product-entity":"_9cxQpR","new-product-entity-img":"_0bprAg","new-product-entity__detail":"Lhlgol","new-product-entity__detail-title":"IY0_Dj","new-product-entity__detail-price":"iIFoc7"}},39701:function(e){e.exports={"base-image-content":"qvYZk1"}},41545:function(e){e.exports={ds:"fUBUO4",ds__header:"iaSrmc",ds__footer:"vlC3Aj",ds__body:"vvJZfe"}},46841:function(e){e.exports={"hashtag-entity":"NEmWlJ","hashtag-entity--fill":"vaCl9X","hashtag-entity--transparent":"_1uMjiE","hashtag-entity__detail":"_6L8FFP"}},33842:function(e){e.exports={"link-entity":"nTFHgf","link-entity__button":"vLIgdz"}},54139:function(e){e.exports={position:"_7yO7DI"}},74511:function(e){e.exports={"product-entity":"DStNAS","product-entity--fill":"tEP9K0","product-entity--fill-img":"JtIp07","product-entity--transparent":"_2h861s","product-entity--transparent-img":"e4n5mP","product-entity__detail":"B_iH0_","product-entity__detail-title":"EjRvSN","product-entity__detail-price":"XK8kPO"}},89184:function(e){e.exports={action:"HxCpqh",action__head:"cfOh31",action__title:"owLdq2"}},5044:function(e){e.exports={wrapper:"GIunDS","wrapper__hashtags-item":"sOwrlE"}},26145:function(e){e.exports={"story-status-bar":"kFLT1y","story-status-bar__wrapper":"AtJxID","story-status-bar__span":"VUkV8G"}},46236:function(e){e.exports={ss:"S9hJAY",ss__header:"WWTfI6",ss__vendor:"qjmDUa","ss__vendor-identifier":"_66k3I8","ss__vendor-identifier-title":"G8VfHw","ss__vendor-info":"kCF_6S","ss__vendor-introduction":"_KqDAt","ss__vendor-detail":"J_DyOh","ss__vendor-detail-name":"jhMlP4","ss__vendor-detail-separator":"TpOVLG","ss__vendor-detail-created-time":"_3Sf4G5","ss__vendor-icons":"zyUMEA","ss__vendor-icon":"In9mUp",ss__content:"ezJffu",ss__footer:"Lk2A78","ss__footer-input":"G1hCQ9","ss__footer-icon":"SPHP0O","ss__footer-send":"XNQQMH","ss__footer-send--fill":"vGYW8k",mute:"tng983"}},27510:function(e){e.exports={story__container:"amf88P","story__progress-bar-container":"mS_BR2","story__not-available":"Hz2nhR",story__modal:"_1nTnMy"}},25320:function(e){e.exports={"story-progress-bar":"q9e_0h","story-progress-bar__item":"m60c1N","story-progress-bar__item--filled":"V97HYE","story-progress-bar__item-progress":"G_wljk","story-progress-bar-fill":"iBb3mZ"}},45843:function(e){e.exports={"story-video-content":"tHH_XH"}}}]);